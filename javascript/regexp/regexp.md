# 正则表达式的模式匹配

正则表达式 (regular expression) 是一个描述字符模式的对象。JavaScript 的 RegExp 类表示正则表达式，String 和 RegExp 都定义了方法，
后者使用正则表达式进行强大的模式匹配和文本检索与替换功能。JavaScript 的正则表达式语法是 Perl 5 的正则表达式语法的大型子集。

## 1 正则表达式的定义

JavaScript 中的正则表达式用 RegExp 对象表示，可以使用 RegExp() 构造函数来创建 RegExp 对象，不过 RegExp 对象更多的是通过一种特殊的
直接量语法来创建。就像通过引号包裹字符的方式来定义字符串直接量一样，正则表达式直接量定义为包含在一对斜杠 (/) 之间的字符，例如：

    var pattern = /s$/;

运行这段代码创建一个新的 RegExp 对象，并将它赋值给变量 pattern 。这个特殊的 RegExp 对象用来匹配所有以字母 "s" 结尾的字符串。用构造函数
RegExp() 也可以定义个与之等价的正则表达式，代码如下：

    var pattern = new RegExp("s$");

### RegExp 直接量和对象的创建

就像字符串和数字一样，程序中每个取值相同的原始类型直接量均表示相同的值，这是显而易见的。程序运行时每次遇到对象直接量 (初始化表达式) 诸如
{} 和 [] 的时候都会创建新对象。比如，如果在循环体中写 var a = [],则每次遍历都会创建一个新的空数组。

正则表达式直接量则与此不同，ECMAScript 3 规定，一个正则表达式直接量会在执行到它时转换为一个 RegExp 对象，同一段代码所表示正则表达式直接
量的每次运算都返回同一个对象。ECMAScript 5 规范则做了相反的规定，同一段代码所表示直接量的每次运算都返回新对象。IE 一直都是按照
ECMAScript 5 规范实现的，多数最新版本的浏览器也开始遵循 ECMAScript 5 ，尽管目前该标准并未全面广泛推行。

在这里揭示了一种非常容易忽略的情况，比如，这段代码在 Firefox 3.6 和 Firefox 4+ 中的运行结果不一致：

    function getRE() {
        var re = /[a-z]/;
        re.foo = "bar";
        return re;
    }

    var reg = getRE(),
        re2 = getRE();

    console.log(reg === re2);    // 在 Firefox 3.6 中返回 true，在 Firefox 4+ 中返回 false
    reg.foo = "baz";
    console.log(re2.foo);   // 在 Firefox 3.6 中返回 "baz"，在 Firefox 4+ 中返回 "bar"

原因可以在 ECMAScript 5 规范中找到，也就是说在 ECMAScript 3 规范中，用正则表达式创建的 RegExp 对象会共享同一个实例，而在
ECMAScript 5 中则是两个独立的实例。而最新的 Firefox 4、Chrome 和 Safari 5 都遵循 ECMAScript 5 标准，以至于 IE6~IE8都
没有很好地遵循 ECMAScript 3 标准，不过在这个问题上反而处理对了。很明显 ECMAScript 5 的规范更符合开发者的期望。


正则表达式的模式规则是由一个字符序列组成的。包括所有字母和数字在内，大多数的字符都是按照直接量仅描述待匹配的字符的。如此说来，
正则表达式 /java/ 可以匹配任何包含 "java" 子串的字符串。除此之外，正则表达式中还有其他具有特殊语义的字符，这些字符并不按照
字面含义进行匹配。比如，正则表达式 /s$/ 包含两个字符，第一个字符 "s" 按照字母含义匹配，第二个字符 $ 是一个具有特殊语义的元
字符，用以匹配字符串的结束。因此这个正则表达式可以匹配任何以 "s" 结束的字符串。

接下来会进一步讲解 JavaScript 正则表达式中使用的各种字符和元字符。

### 1.1 直接量字符

正如上文提到的，正则表达式中的所有字母和数字都是按照字面含义进行匹配的。JavaScript 正则表达式语法也支持非字母的字符匹配，这些字符需要通过
反斜线 (\) 作为前缀进行转义。比如，转义字符 \n 用以匹配换行符。下表中列出了这些转义字符。

**表1：正则表达式中的直接量字符**

<table>
	<thead>
		<tr><th>字符</th><th>匹配</th></tr>
	</thead>
	<tbody>
		<tr><td>字母和数字字符</td><td>自身</td></tr>
		<tr><td>\o</td><td>NUL字符(\u0000)</td></tr>
		<tr><td>\t</td><td>制表符(\u0009)</td></tr>
		<tr><td>\n</td><td>换行符(\u000A)</td></tr>
		<tr><td>\v</td><td>垂直制表符(\u000B)</td></tr>
		<tr><td>\f</td><td>换页符(\u000C)</td></tr>
		<tr><td>\r</td><td>回车符(\u000D)</td></tr>
		<tr><td>\xnn</td><td>由十六进制数nn指定的拉丁字符，例如，\x0A 等价于 \n</td></tr>
		<tr><td>\unnnn</td><td>由十六进制数nnnn指定的Unicode字符，例如，\u0009 等价于 \t</td></tr>
		<tr><td>\cX</td><td>控制字符^X，例如，\cJ 等价于换行符 \n</td></tr>
	</tbody>
</table>

在正则表达式中，许多标点符号具有特殊含义，它们是：

    ^ $ . * + ? = ! : | \ / ( ) [ ] { }

接下来，我们将学习这些符号的含义。某些符号只有在正则表达式的某些上下文中才具有某种特殊含义，在其他上下文中则被当成直接量处理。然而，如果
想在正则表达式中使用这些字符的直接量进行匹配，则必须使用前缀 \ ，这是一条通行规则。其他标点符号 (比如 @ 和引号) 没有特殊含义，在正则
表达式中按照字面含义进行匹配。

如果不记得哪些标点符号需要反斜线转义，可以在每个标点前都加上反斜线。另外需要注意，许多字母和数字在有反斜线做前缀时也有特殊含义，所以对于想
按照直接量进行匹配的字母和数字，尽量不要用反斜线对其转义。当然，要想在正则表达式中按照直接量匹配反斜线本身，则必须使用反斜线将其转义。比如，
正则表达式 "/\\/" 用以匹配任何包含反斜线的字符串。

### 1.2 字符类

将直接量字符单独放进方括号内就组成了字符类 (character class) 。一个字符类可以匹配它所包含的任意字符。因此，正则表达式 /[abc]/ 就和
字母 "a"、"b"、"c" 中的任意一个都匹配。另外，可以通过 "^" 符号来定义否定字符类，它匹配所有不包含在方括号内的字符。定义否定字符类时，
将一个 "^" 符号作为左方括号内的第一个字符。正则表达式 /[^abc]/ 匹配的是 "a"、"b"、"c"之外的所有字符。字符类可以使用连字符来表示字符
范围。要匹配拉丁字母表中的小写字母，可以使用 /[a-z]/，要匹配拉丁字母表中任何字母和数字，则使用 /[a-zA-Z0-9]/ 。

由于某些字符类非常常用，因此在 JavaScript 的正则表达式语法中，使用了这些特殊字符的转义字符来表示它们。例如， \s 匹配的是空格符、制表符
和其他 Unicode 空白符，\S 匹配的是非 Unicode 空白负的字符。下表列出了这些字符，并且总结了字符类的语法 (注意，有些字符类转义字符只能
匹配 ASCII 字符，还没有扩展到可以处理 Unicode 字符，但可以通过十六进制表示方法来显示定义 Unicode 字符类，例如， /[\u0400-\u04FF]/ 用以
匹配所有的 Cyrillic 字符)。

**表2：正则表达式的字符类**

<table>
	<thead>
		<tr><th>字符</th><th>匹配</th></tr>
	</thead>
	<tbody>
		<tr><td>[...]</td><td>方括号内的任意字符</td></tr>
		<tr><td>[^...]</td><td>不在方括号内的任意字符</td></tr>
		<tr><td>.</td><td>除换行符和其他Unicode行终止符之外的任意字符</td></tr>
		<tr><td>\w</td><td>任何包括下划线的 ASCII 字符组成的单词，类似但不等价于 [a-zA-Z0-9_]</td></tr>
		<tr><td>\W</td><td>任何不是 ASCII 字符组成的单词，等价于 [^a-zA-Z0-9_]</td></tr>
		<tr><td>\s</td><td>任何Unicode空白符</td></tr>
		<tr><td>\S</td><td>任何非Unicode空白符的字符，注意 \w 和 \S 不同</td></tr>
		<tr><td>\d</td><td>任何 ASCII 数字，等价于 [0-9]</td></tr>
		<tr><td>\D</td><td>除了 ASCII 数字之外的任何字符，等价于 [^0-9]</td></tr>
		<tr><td>[\b]</td><td>退格直接量 (特例)</td></tr>
	</tbody>
</table>

注意，在方括号之内也可以写这些特殊转义字符。比如，由于 \s 匹配所有的空白负，\d 匹配的是所有数字，因此 /[\s\d]/ 就匹配任意空白符或者数字。
注意，这里有一个特例。下面我们将会看到转义符 \b 具有的特殊含义，当用在字符类中时，它表示的是退格符，所以要在正则表达式中按照直接量表示一个
退格符，只需要使用具有一个元素的字符类 /[\b]/ 。

